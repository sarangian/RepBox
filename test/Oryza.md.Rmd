---
title: "Oryza sativa GFF characterization"
output: markdown
---

# Color Palette
# #2B3042
# #6B8C7A
# #BDB08D
# #EBD095
# #EE9295

#################################################################################

# Library Initiation
```{r}
library("dplyr")
library("chromPlot")
library("stringr")
library("reticulate")
```

### Reference GFF
```{r}
Oryza_ref <- read.delim("/Users/shelvasha/Documents/Dissertation/results/results_Oryza_sativa/comparison/irgsp1_repeat_unit.gff",header=FALSE)
names(Oryza_ref)[1:9] <- c("Chrom","Source","Type","Start","End","Score","Strand","Phase","Attributes")
Oryza_ref$Chrom <- str_replace(Oryza_ref$Chrom, "chr0","")
Oryza_ref$Chrom <- str_replace(Oryza_ref$Chrom, "chr","")

library("rtracklayer")
export(Oryza_ref,con = "Oryza_reference.gff3", format="gff3")

output0 <- data.frame(str_remove(str_split(str_split(toString(Oryza_ref[9][1]),"Name=", simplify = TRUE),",", simplify = TRUE)[,1],'"'))
output0 <- data.frame(output0[2:nrow(output0),])
output0[nrow(output0),]<- str_sub(output0[nrow(output0),], end=-2)
write.table(output0, file="Oryza_REF.txt", quote=FALSE, row.names=FALSE, col.names=FALSE)

use_python("/usr/local/bin/python3")
```

# Parsing of TE Families from Reference GFF
```{python}
import os
f=open("Oryza_REF.txt")
line=f.readlines()
g=open("Oryza_REF_OUT.txt", 'w')
for lines in line:
    if "#" in lines:
        print(lines.split('#')[1], file=g)
    else:
        print("Other", file=g)
  
g.close()
````

```{r}
Oryza_ref_TE_profile <- read.delim("Oryza_REF_OUT.txt",header=FALSE)
Oryza_ref_TE_profile <- data.frame(table(Oryza_ref_TE_profile))
names(Oryza_ref_TE_profile) <- c("Transposon Family","Count")
write.table(Oryza_ref_TE_profile, file="Oryza_ref_TE_profile.txt", quote=FALSE, row.names=FALSE, col.names=TRUE, sep = ",")
```


```{python}
import os

f=open("Oryza_REF.txt")
line=f.readlines()

# Oryza_REF_OUT.txt contains subfamily information within each family 
g=open("Oryza_REF_OUT.txt", 'w')
for lines in line:
  if '#' in lines:
      print(lines.split("Alias=")[0].split('#')[0],',',lines.split("Alias=")[0].split('#')[1], file=g, end='')
  else:
      print(lines.split("Alias=")[0].split('#')[0].replace('\n',''),',','Unknown', file=g)



g.close()
f.close()
```


### Helitrons
# Reference GFF
```{r}
helitron_reference <- Oryza_ref[str_detect(Oryza_ref$Attributes,"#RC"),]
helitron_reference_format <- dplyr::select(helitron_reference, c(1,4,5))
export(helitron_reference,con="Oryza_helitron_reference.gff3", format="gff3")
output1 <- data.frame(str_remove(str_split(str_split(toString(helitron_reference[9][1]),"Name=", simplify = TRUE),",", simplify = TRUE)[,1],'"'))
output1 <- data.frame(output1[2:nrow(output1),])
output1[nrow(output1),]<- str_sub(output1[nrow(output1),], end=-2)
write.table(output1, file="Oryza_HEL.txt", quote=FALSE, row.names=FALSE, col.names=FALSE)
use_python("/usr/local/bin/python3")
```



```{python}

f=open("Oryza_HEL.txt")
line=f.readlines()
g=open("Oryza_HEL_OUT.txt", 'w')
for lines in line:
    if "#RC" in lines:
        print(lines.split('#')[0], file=g)

  
g.close()
````



```{python}
import os
f=open("Oryza_HEL.txt")
line=f.readlines()
g=open("Oryza_HEL_OUT.txt", 'w')
for lines in line:
    if "=" in lines:
        print(lines.split('=')[1], file=g)
    else:
        print("Other", file=g)
        
g.close()
````


```{r}
Oryza_hel_profile <- read.delim("Oryza_HEL_OUT.txt",header=FALSE)
Oryza_hel_profile <- data.frame(table(Oryza_hel_profile))
names(Oryza_hel_profile) <- c("Transposon Family","Count")
Oryza_hel_profile
```


# EAHelitron GFF
```{r}
Oryza_ea_helitron_gff <- read.delim("/Users/shelvasha/Documents/Dissertation/results/results_Oryza_sativa/eahelitron_out/EAHeli_out.gff3", header = FALSE)
names(Oryza_ea_helitron_gff)[1:9] <- c("Chrom","Source","Type","Start","End","Score","Strand","Phase","Attributes")
Oryza_ea_helitron_gff <- Oryza_ea_helitron_gff[2:nrow(Oryza_ea_helitron_gff),]
Oryza_ea_helitron_gff_format <- dplyr::select(Oryza_ea_helitron_gff,c(1,4,5))
```

# HelitronScanner GFF
```{r}
Oryza_helitron_scanner_gff <- read.delim("/Users/shelvasha/Documents/Dissertation/results/results_Oryza_sativa/helitronscanner_out/helitronscanner_out.Oryza_sativa.hel.gff3", header = FALSE)
names(Oryza_helitron_scanner_gff)[1:9] <- c("Chrom","Source","Type","Start","End","Score","Strand","Phase","Attributes")
Oryza_helitron_scanner_gff <- Oryza_helitron_scanner_gff[2:nrow(Oryza_helitron_scanner_gff),]
Oryza_helitron_scanner_gff_format <- dplyr::select(Oryza_helitron_scanner_gff,c(1,4,5))
```

#### Helitron Comparisons

```{bash}

## EAHelitron - Reference
# Bash commands
bedtools intersect -a /Users/shelvasha/Documents/Dissertation/R\ Scripts/Oryza_reference.gff3 -b /Users/shelvasha/Documents/Dissertation/results/results_Oryza_sativa/eahelitron_out/EAHeli_out.gff3 -f 0.8 > Oryza_ref_Helitron_EAHelitron_overlap.gff3

## HelitronScanner - Reference
# Bash commands
bedtools intersect -a /Users/shelvasha/Documents/Dissertation/R\ Scripts/Oryza_reference.gff3 -b /Users/shelvasha/Documents/Dissertation/results/results_Oryza_sativa/helitronscanner_out/helitronscanner_out.Oryza_sativa.hel.gff3 -f 0.8 > Oryza_ref_Helitron_HelitronScanner_overlap.gff3

```

```{r}
# EAHelitron
Oryza_ref_EAHelitron_compare <- read.delim("Oryza_ref_Helitron_EAHelitron_overlap.gff3",header=FALSE)
names(Oryza_ref_EAHelitron_compare)[1:9] <- c("Chrom","Source","Type","Start","End","Score","Strand","Phase","Attributes")
Oryza_ref_EAHelitron_compare_format <- dplyr::select(Oryza_ref_EAHelitron_compare, c(1,4,5))
#EAplot <- chromPlot(annot1 = Oryza_ref_EAHelitron_compare_format)

# HelitronScanner
Oryza_ref_HelitronScanner_compare <- read.delim("Oryza_ref_Helitron_HelitronScanner_overlap.gff3",header=FALSE)
names(Oryza_ref_HelitronScanner_compare)[1:9] <- c("Chrom","Source","Type","Start","End","Score","Strand","Phase","Attributes")
Oryza_ref_HelitronScanner_compare_format <- dplyr::select(Oryza_ref_HelitronScanner_compare, c(1,4,5))
HSplot <- chromPlot(annot1 = Oryza_ref_HelitronScanner_compare_format)

```

# Helitron Counts & Comparisons of novel Software
```{r}
ea_helitron_count <- nrow(ea_helitron_gff)
helitron_scanner_count <- nrow(helitron_scanner_gff)
ref_helitron_count <- nrow(helitron_reference)
barplot(cbind(ref_helitron_count,ea_helitron_count, helitron_scanner_count))
helitron_table <- data.frame(rbind(ref_helitron_count,ea_helitron_count, helitron_scanner_count))
```

```{bash}
bedtools intersect -a /Users/shelvasha/Documents/Dissertation/results/results_Oryza_sativa/eahelitron_out/EAHeli_out.gff3 -b /Users/shelvasha/Documents/Dissertation/results/results_Oryza_sativa/helitronscanner_out/helitronscanner_out.Oryza_sativa.hel.gff3 -wao > Oryza_EA_HS_overlap.gff3
```

```{r}
Oryza_EA_HS <- read.delim("Oryza_EA_HS_overlap.gff3")
names(Oryza_EA_HS)[1:9] <- c("Chrom","Source","Type","Start","End","Score","Strand","Phase","Attributes")
Oryza_EA_HS
write.table(Oryza_EA_HS, file="Oryza_EAHelitron-Helitronscanner_comparision.txt", quote=FALSE, row.names=FALSE, col.names=FALSE)
```



#################################################################################

#### MITEs
# Reference
```{r}
Oryza_mite_reference <- Oryza_ref[str_detect(Oryza_ref$Attributes,"#DNA/Mite"),]
export(Oryza_mite_reference,con="Oryza_mite_reference.gff3", format="gff3")
output2 <- data.frame(str_remove(str_split(str_split(toString(Oryza_mite_reference[9][1]),"Name=", simplify = TRUE),",", simplify = TRUE)[,1],'"'))
output2 <- data.frame(output2[2:nrow(output2),])
output2[nrow(output2),]<- str_sub(output2[nrow(output2),], end=-2)
write.table(output2, file="Oryza_DNA.txt", quote=FALSE, row.names=FALSE, col.names=FALSE)
use_python("/usr/local/bin/python3")
```

```{python}
import os
# os. getcwd()
f=open("Oryza_DNA.txt")
line=f.readlines()
g=open("Oryza_DNA_OUT.txt", 'w')
for lines in line:
    if "#" in lines:
        print(lines.split('#')[1], file=g)
    else:
        print("Other", file=g)

g.close()
````

```{r}
Oryza_dna_profile <- read.delim("Oryza_DNA_OUT.txt",header=FALSE)
Oryza_dna_profile <- data.frame(table(Oryza_dna_profile))
names(Oryza_dna_profile) <- c("Transposon Family","Count")
Oryza_dna_profile

```

# MITETracker GFF3 - Parsing
```{r}
Oryza_mitetracker <- read.delim("/Users/shelvasha/Documents/Dissertation/results/results_Oryza_sativa/mitetracker_out/Oryza_sativa/all.gff3",header=FALSE)
Oryza_mitetracker <- Oryza_mitetracker[2:nrow(Oryza_mitetracker),]
names(Oryza_mitetracker)[1:9] <- c("Chrom","Source","Type","Start","End","Score","Strand","Phase","Attributes")
```

# MITEFinder GFF3
```{r}
Oryza_mitefinder <- read.delim("/Users/shelvasha/Documents/Dissertation/results/results_Oryza_sativa/mitefinder_out/mitefinder.gff3",header=FALSE)
Oryza_mitefinder <- Oryza_mitefinder[2:nrow(Oryza_mitefinder),]
names(Oryza_mitefinder)[1:9] <- c("Chrom","Source","Type","Start","End","Score","Strand","Phase","Attributes")
```

### GFF Comparisons
```{bash}
## MITETracker - Reference
# Bash commands:
bedtools intersect -a /Users/shelvasha/Documents/Dissertation/R\ Scripts/Oryza_reference.gff3 -b /Users/shelvasha/Documents/Dissertation/results/results_Oryza_sativa/mitetracker_out/Oryza_sativa/all.gff3 -f 0.8 > Oryza_ref_MITE_MITETracker_overlap.gff3

## MITEFinder - Reference
# Bash commands
bedtools intersect -a /Users/shelvasha/Documents/Dissertation/R\ Scripts/Oryza_reference.gff3 -b /Users/shelvasha/Documents/Dissertation/results/results_Oryza_sativa/mitefinder_out/mitefinder.gff3 -f 0.8 > Oryza_ref_MITE_MITEFinder_overlap.gff3
```


```{r}
# MITETracker
Oryza_ref_MT_compare <- read.delim("Oryza_ref_MITE_MITETracker_overlap.gff3",header=FALSE)
names(Oryza_ref_MT_compare)[1:9] <- c("Chrom","Source","Type","Start","End","Score","Strand","Phase","Attributes")
Oryza_ref_MT_compare_format <- dplyr::select(Oryza_ref_MT_compare, c(1,4,5))
MTplot <- chromPlot(annot1 = ref_MT_compare_format)

# MITEFinder
Oryza_ref_MF_compare<- read.delim("Oryza_ref_MITE_MITEFinder_overlap.gff3", header = FALSE)
names(Oryza_ref_MF_compare)[1:9] <- c("Chrom","Source","Type","Start","End","Score","Strand","Phase","Attributes")
Oryza_ref_MF_compare_format <- dplyr::select(Oryza_ref_MF_compare, c(1,4,5))
MFplot <- chromPlot(annot1 = Oryza_ref_MF_compare_format)
```

# MITE Counts
```{r}
Oryza_mitefinder_count <- nrow(Oryza_mitefinder)
Oryza_mitetracker_count <- nrow(Oryza_mitetracker)
Oryza_mite_reference_count <- nrow(mite_reference)
barplot(cbind(Oryza_mite_reference_count, Oryza_mitefinder_count, Oryza_mitetracker_count))
```

```{bash}
bedtools intersect -a /Users/shelvasha/Documents/Dissertation/results/results_Oryza_sativa/mitetracker_out/Oryza_sativa/all.gff3 -b /Users/shelvasha/Documents/Dissertation/results/results_Oryza_sativa/mitefinder_out/mitefinder.gff3 -u > Oryza_MT_MF_overlap.gff3
```

```{r}
Oryza_MT_MF <- read.delim("Oryza_MT_MF_overlap.gff3")
names(Oryza_MT_MF)[1:9] <- c("Chrom","Source","Type","Start","End","Score","Strand","Phase","Attributes")
write.table(Oryza_MT_MF, file="Oryza_MITEFinder-MITETracker_comparision.txt", quote=FALSE, row.names=FALSE, col.names=FALSE)
```
#################################################################################


#### SINEs
# Reference
```{r setup, include=FALSE, echo=TRUE}
Oryza_sine_reference <- Oryza_ref[str_detect(Oryza_ref$Attributes,"#SINE"),]
export(sine_reference,con="Oryza_sine_reference.gff3", format="gff3")
output3 <- data.frame(str_remove(str_split(str_split(toString(sine_reference[9][1]),"Name=", simplify = TRUE),",", simplify = TRUE)[,1],'"'))
output3 <- data.frame(output3[2:nrow(output3),])
output3[nrow(output3),]<- str_sub(output3[nrow(output3),], end=-2)
write.table(output3, file="Oryza_SINE.txt", quote=FALSE, row.names=FALSE, col.names=FALSE)

use_python("/usr/local/bin/python3")
```

```{python}
import os
# os. getcwd()
f=open("Oryza_SINE.txt")
line=f.readlines()
g=open("Oryza_SINE_OUT.txt", 'w')
for lines in line:
    if "#" in lines:
        print(lines.split('#')[1], file=g)
    else:
        print("Other", file=g)

g.close()
````

```{r}
Oryza_sine_profile <- read.delim("Oryza_SINE.txt",header=FALSE)
Oryza_sine_profile <- data.frame(table(Oryza_sine_profile))
names(Oryza_sine_profile) <- c("Transposon Family","Count")
Oryza_sine_profile
write.table(Oryza_sine_profile, file="Oryza_SINE_TE_profile.txt", quote=FALSE, row.names=FALSE, sep=",")

```

# SINE_Scan GFF3 - Parsing
```{r}
sinescan <- read.delim("",header=FALSE)
names(sinescan)[1:9] <- c("Chrom","Source","Type","Start","End","Score","Strand","Phase","Attributes")
```

### GFF Comparisons

## SineScan - Reference
# Bash commands: bedtools intersect -a /Users/shelvasha/Documents/Dissertation/results/results_Oryza_sativa/comparison/Oryza_MITE_reference_annotation.gff -b /Users/shelvasha/Repbox/mitetracker_out/Oryza_sativa/all.gff3 > ref_MITE_MITETracker_overlap.gff3

```{r}
# SINEScan
ref_sinescan_compare <- read.delim("",header=FALSE)
names(ref_sinescan_compare)[1:9] <- c("Chrom","Source","Type","Start","End","Score","Strand","Phase","Attributes")
ref_sinescan_compare_format <- dplyr::select(ref_sinescan_compare, c(1,4,5))
Splot <- chromPlot(annot1 = ref_sinescan_compare_format)
```

# SINE Counts
```{r}
sinescan_count <- nrow(mitefinder)
sine_reference_count <- nrow(sinescan)
barplot(cbind(mite_reference_count, mitefinder_count, mitetracker_count))
```
